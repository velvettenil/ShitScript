local P=game:GetService("Players")
local R=game:GetService("RunService")
local T=game:GetService("TweenService")
local p=P.LocalPlayer
local c=workspace.CurrentCamera
local g=p:WaitForChild("PlayerGui")
local M=2000 -- max dist
local S=0.6 -- smooth
local E=true
local D=0.6
local B=0
local F=2.5
local L=0.0035
local a=false
local n=nil
local z={}
local x=Instance.new("ScreenGui") x.Name="FPG" x.Parent=g
local b=Instance.new("TextButton") b.Name="fpt" b.Size=UDim2.new(0,140,0,44)
b.Position=UDim2.new(.5,-70,.92,-22) b.AnchorPoint=Vector2.new(.5,.5)
b.Text="OFF" b.Parent=x
local d=Instance.new("Frame") d.Name="D" d.Size=UDim2.new(0,12,0,12) d.Parent=b

local function k(h,j,y) if not z[h] then z[h]={l=j,t=y,v=Vector3.new()} end end
local function u(h,j,y)
    if not h then return end
    if not z[h] then z[h]={l=j,t=y,v=Vector3.new()} return end
    local st=z[h] local dt=y-st.t if dt<=0 then return end
    local rv=(j-st.l)/dt st.v=st.v:Lerp(rv,S) st.l=j st.t=y
end
local function m(dist)
    if B>0 then local tr=dist/B return math.min(D+tr,F)
    else local l=D+dist*L return math.min(l,F) end
end
local function G(H)
    local ch=H.Parent
    local st=z[ch] or {v=Vector3.zero}
    local v=st.v or Vector3.zero
    local cp=c.CFrame.Position
    local dist=(H.Position-cp).Magnitude
    local ls=m(dist)
    return H.Position+v*ls
end
local function f()
    local bh=nil;local bd=math.huge;local nw=tick();local cp=c.CFrame.Position;
    for _,pl in ipairs(P:GetPlayers())do
        if pl~=p then
            local ch=pl.Character
            local hu=ch and ch:FindFirstChildOfClass("Humanoid")
            local hd=ch and ch:FindFirstChild("Head")
            if hu and hd and hu.Health>0 then
                u(ch,hd.Position,nw)
                local dist=(hd.Position-cp).Magnitude
                if dist<bd and dist<=M then bd=dist;bh=hd; end
            end
        end
    end
    return bh
end

local function v()
    if a then return end
    a=true
    b.Text="ON"
    n=R.RenderStepped:Connect(function()
        if not a then return end
        local hd=f()
        if hd and hd.Parent then
            local cp=c.CFrame.Position
            local tp=E and G(hd) or hd.Position
            local currentCFrame=c.CFrame
            local targetCFrame=CFrame.new(cp,tp)
            c.CFrame=currentCFrame:Lerp(targetCFrame,S)
        end
    end)
end

local function w()
    if not a then return end
    a=false
    b.Text="OFF"
    if n then n:Disconnect() n=nil end
end

b.MouseButton1Click:Connect(function()
    if a then w() else v() end
end)
p.CharacterRemoving:Connect(function()
    z={}
    w()
end)